{% extends "base.html" %}
{% block title %}{{ task.name }}{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="mb-0">{{ task.name }}</h2>
  <div class="d-flex gap-2">
    <a class="btn btn-outline-secondary" href="{% url 'core:task_list' %}">До списку</a>
    {% if user == task.creator %}
      <a class="btn btn-primary" href="{% url 'core:task_update' task.pk %}">Редагувати</a>
      <a class="btn btn-danger" href="{% url 'core:task_delete' task.pk %}">Видалити</a>
    {% endif %}
  </div>
</div>

<div class="card mb-4">
  <div class="card-body">
    <div class="mb-2">
      <span class="badge text-bg-secondary">{{ task.get_status_display }}</span>
      <span class="badge text-bg-info">{{ task.get_priority_display }}</span>
      {% if task.deadline %}
        <span class="badge text-bg-light border">Дедлайн: {{ task.deadline|date:"Y-m-d H:i" }}</span>
        {% if task.is_expired %}
          <span class="badge text-bg-danger">Прострочено</span>
        {% endif %}
      {% endif %}
    </div>
    <p class="mb-0">{{ task.description|linebreaks }}</p>
    <div class="text-muted small mt-2">Створив: {{ task.creator.username }}</div>
  </div>
</div>

<h4 class="mb-3">Коментарі</h4>
<div class="mb-4">
  {% if comments %}
    <div class="list-group">
      {% for comment in comments %}
        <div class="list-group-item">
          <div class="d-flex justify-content-between">
            <div class="fw-semibold">
              {{ comment.author.username|default:"Видалений користувач" }}
              <span class="text-muted small">• {{ comment.created_at|date:"Y-m-d H:i" }}</span>
            </div>
            {% if user.is_authenticated and comment.author == user %}
              <div class="d-flex gap-2">
                <a class="btn btn-sm btn-outline-secondary" href="{% url 'core:comment_edit' comment.pk %}">Редагувати</a>
                <a class="btn btn-sm btn-outline-danger" href="{% url 'core:comment_delete' comment.pk %}">Видалити</a>
              </div>
            {% endif %}
          </div>
          <div class="mt-2">{{ comment.content|linebreaks }}</div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-light border">Поки що немає коментарів</div>
  {% endif %}
</div>

{% if user.is_authenticated %}
  <div class="card">
    <div class="card-body">
      <h5 class="card-title">Додати коментар</h5>
      <form method="post">
        {% csrf_token %}
        <div class="mb-3">
          {{ form.content.label_tag }}
          {{ form.content }}
          {% if form.content.errors %}
            <div class="text-danger small">{{ form.content.errors }}</div>
          {% endif %}
        </div>
        <button class="btn btn-primary" type="submit">Опублікувати</button>
      </form>
    </div>
  </div>
{% else %}
  <div class="alert alert-info">
    <a href="{% url 'login' %}?next={{ request.path }}">Увійдіть</a>, щоб додати коментар.
  </div>
{% endif %}
{% endblock %}